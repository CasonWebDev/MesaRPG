# MesaRPG - Status do Projeto

## üìã Vis√£o Geral

O MesaRPG √© uma plataforma de Virtual Tabletop (VTT) para campanhas de RPG, desenvolvida em Next.js 15 com integra√ß√£o completa entre frontend e backend. O projeto permite que mestres (GMs) criem e gerenciem campanhas, enquanto jogadores podem participar de sess√µes em tempo real.

## üéØ Objetivo Principal

Criar uma plataforma funcional de RPG online que:
- Preserve 100% do layout e design existente
- Implemente funcionalidades completas no backend
- Ofere√ßa experi√™ncia em tempo real para m√∫ltiplos usu√°rios
- Suporte cria√ß√£o e gerenciamento de campanhas
- Permita chat e sistema de dados integrado

## ‚úÖ Fases Completadas

### **Fase 1: Configura√ß√£o de Middleware e Autentica√ß√£o**
- ‚úÖ **Middleware de autentica√ß√£o** (`middleware.ts`)
  - Prote√ß√£o de rotas `/dashboard` e `/campaign/*`
  - Redirecionamento autom√°tico para login
- ‚úÖ **Layout com providers** (`app/layout.tsx`)
  - `ClientProviders` para `SessionProvider` e `Toaster`
  - Separa√ß√£o correta de Server/Client Components
- ‚úÖ **P√°ginas de autentica√ß√£o**
  - Login integrado com NextAuth (`app/login/page.tsx`)
  - Registro com valida√ß√£o e toast notifications (`app/register/page.tsx`)

### **Fase 2: Integra√ß√£o do Dashboard com API de Campanhas**
- ‚úÖ **Dashboard din√¢mico** (`app/dashboard/page.tsx`)
  - Server Component que busca campanhas reais do banco
  - Separa√ß√£o entre campanhas pr√≥prias (GM) e participa√ß√£o (Jogador)
  - Estado vazio com call-to-action
- ‚úÖ **Sistema de cria√ß√£o de campanhas**
  - API endpoint `/api/campaigns/create/route.ts`
  - Dialog component com valida√ß√£o (`components/create-campaign-dialog.tsx`)
  - Integra√ß√£o com toast notifications
- ‚úÖ **Database Schema atualizado**
  - Campo `system` adicionado ao modelo Campaign
  - Relacionamentos corrigidos (`ownerId`, `CampaignMember`)

### **Fase 3: Integra√ß√£o da P√°gina de Jogo Principal**
- ‚úÖ **Server Component principal** (`app/campaign/[id]/play/page.tsx`)
  - Valida√ß√£o de sess√£o e acesso √† campanha
  - Verifica√ß√£o autom√°tica de role (GM/Jogador)
  - Redirecionamento com role correto
- ‚úÖ **Client Component separado** (`app/campaign/[id]/play/game-client.tsx`)
  - Interface interativa sem uso de Context em Server Component
  - Recebe dados validados do servidor

### **Fase 4: Integra√ß√£o do Sistema de Chat e WebSocket**
- ‚úÖ **API de mensagens** (`app/api/campaigns/[id]/messages/route.ts`)
  - GET: carregamento de hist√≥rico de mensagens
  - POST: cria√ß√£o de novas mensagens
  - Valida√ß√£o de acesso √† campanha
- ‚úÖ **Hook WebSocket** (`hooks/use-socket.ts`)
  - Conex√£o em tempo real com Socket.IO
  - Gerenciamento de estado de mensagens e jogadores conectados
  - Fun√ß√µes para envio de mensagens e movimenta√ß√£o de tokens
- ‚úÖ **Componente de Chat** (`components/game/chat-panel.tsx`)
  - Interface completa com suporte a comandos `/r` (dados) e `/ooc`
  - Integra√ß√£o com sistema de dados
  - Estados de conex√£o e loading

### **Fase 5: Sistema Completo de Personagens**
- ‚úÖ **API de Characters** (`app/api/campaigns/[id]/characters/route.ts`)
  - CRUD completo de personagens (GET, POST, PUT, DELETE)
  - Filtros por tipo (PC, NPC, CREATURE) e criador (GM/Player)
  - Valida√ß√£o de permiss√µes e acesso
- ‚úÖ **Hook useCharacters** (`hooks/use-characters.ts`)
  - Gerenciamento de estado de personagens
  - Fun√ß√µes especializadas (getNPCs, getCreatures, getPCs, getPlayerCharacters)
  - Sistema de busca e filtros
  - Estat√≠sticas de personagens
- ‚úÖ **Templates de Fichas** (`hooks/use-characters.ts`)
  - Hook useCharacterTemplates com API integrada
  - Fun√ß√µes getTemplateForType e getDefaultFields memoizadas
  - Sistema de campos din√¢micos baseado em templates
- ‚úÖ **Cria√ß√£o de Personagens**
  - Dialog unificado (`components/create-character-dialog.tsx`)
  - Suporte a diferentes tipos (PC, NPC, CREATURE)
  - Valida√ß√£o completa e tratamento de erros
  - Integra√ß√£o com templates din√¢micos
- ‚úÖ **Visualiza√ß√£o de Fichas**
  - Componente CharacterSheetView (`components/character-sheet-view.tsx`)
  - Renderiza√ß√£o din√¢mica baseada em templates
  - Suporte a diferentes tipos de campos (text, number, image, etc.)
  - Sistema de avatar com fallback
- ‚úÖ **Sistema de Conte√∫do da Sidebar**
  - PlayerCharacterSheetPanel integrado para jogadores
  - PlayerSheetList para GM ver fichas dos jogadores
  - NpcList e CreatureList para gerenciamento do mestre
  - Mini resumos inteligentes com avatar e campos principais

### **Fase 6: Sistema de Handouts e Conte√∫do**
- ‚úÖ **API de Handouts** (`app/api/campaigns/[id]/handouts/route.ts`)
  - CRUD completo de handouts (GET, POST, PUT, DELETE)
  - Sistema de compartilhamento com controle de acesso
  - Suporte a anexos e attachments
- ‚úÖ **Componente de Handouts** (`components/sidebar-content/handout-list.tsx`)
  - Listagem de handouts com filtro por visibilidade
  - Interface de cria√ß√£o e edi√ß√£o
  - Sistema de compartilhamento GM ‚Üí Jogadores
- ‚úÖ **Modais de Handouts**
  - Modal de visualiza√ß√£o (`components/modals/view-handout-modal.tsx`)
  - Modal de compartilhamento (`components/modals/share-handout-modal.tsx`)
  - Suporte a attachments e preview

### **Fase 7: Sistema de Mapas e Grid T√°tico**
- ‚úÖ **API de Mapas** (`app/api/campaigns/[id]/maps/route.ts`)
  - CRUD completo de mapas (GET, POST, PUT, DELETE)
  - Sistema de ativa√ß√£o de mapas
  - Configura√ß√£o de grid customiz√°vel
- ‚úÖ **Componente de Mapas** (`components/sidebar-content/map-list.tsx`)
  - Listagem de mapas com preview
  - Interface de cria√ß√£o e edi√ß√£o
  - Sistema de ativa√ß√£o em tempo real via WebSocket
  - Fallback HTTP para maior confiabilidade
  - Sincroniza√ß√£o autom√°tica entre usu√°rios
- ‚úÖ **Grid T√°tico B√°sico** (`components/game/tactical-grid.tsx`)
  - Sistema simples e funcional (800x600px)
  - Coordenadas simples (pixel-based)
  - Sistema b√°sico de tokens
  - WebSocket integrado para sincroniza√ß√£o
- ‚úÖ **Sistema de Tokens Simples** 
  - Movimenta√ß√£o em tempo real via WebSocket
  - Sincroniza√ß√£o b√°sica entre m√∫ltiplos clientes
  - Sistema de coordenadas simples (pixel-based)
  - Movimento livre para todos os usu√°rios
- ‚úÖ **Notifica√ß√µes de Mapas** (`hooks/use-map-notifications.ts`)
  - Notifica√ß√µes autom√°ticas de mudan√ßa de mapa
  - Sistema de refresh para jogadores
  - Toast notifications para ativa√ß√£o de mapas

### **Fase 8: Sistema de Arquivos**
- ‚úÖ **API de Upload** (`app/api/upload/route.ts`)
  - Upload de arquivos com categoriza√ß√£o
  - Suporte a m√∫ltiplos formatos (imagem, documento)
  - Valida√ß√£o de tamanho e tipo
- ‚úÖ **Gerenciador de Arquivos** (`components/file-manager/file-manager.tsx`)
  - Interface completa de gerenciamento
  - Visualiza√ß√£o em grid e lista
  - Sistema de busca e filtros
- ‚úÖ **Upload de Arquivos** (`components/file-manager/file-upload.tsx`)
  - Drag & drop interface
  - Progress tracking
  - Valida√ß√£o client-side

### **Fase 9: Configura√ß√µes da Campanha**
- ‚úÖ **P√°gina de Configura√ß√µes** (`app/campaign/[id]/settings/page.tsx`)
  - Interface completa de configura√ß√µes do GM
  - M√∫ltiplas abas organizadas
- ‚úÖ **Gerenciamento de Jogadores** (`components/settings/player-management.tsx`)
  - Sistema de convites para jogadores
  - Gerenciamento de membros da campanha
  - Controle de permiss√µes
- ‚úÖ **Editor de Templates** (`components/settings/sheet-template-editor.tsx`)
  - Interface drag & drop para campos
  - Valida√ß√£o de templates
  - Preview em tempo real
- ‚úÖ **Sistema de Convites** (`app/api/campaigns/[id]/create-invite/route.ts`)
  - Cria√ß√£o de links de convite
  - Sistema de expira√ß√£o autom√°tica
  - P√°gina de aceite de convites (`app/invite/[token]/page.tsx`)
- ‚úÖ **Configura√ß√µes Gerais** (`components/settings/general-settings.tsx`)
  - Configura√ß√µes b√°sicas da campanha
  - Sistema de valida√ß√£o avan√ßada

### **Fase 10: Limpeza e Simplifica√ß√£o**
- ‚úÖ **Remo√ß√£o de C√≥digo √ìrf√£o**
  - Removidos hooks n√£o utilizados (`use-avatar-sync.ts`, `use-character-tokens.ts`)
  - Limpeza de documenta√ß√£o desatualizada
  - Remo√ß√£o de APIs quebradas e features n√£o funcionais
- ‚úÖ **Simplifica√ß√£o do Sistema de Tokens**
  - Sistema ultra-b√°sico com movimento livre
  - WebSocket integrado via `socket-bridge.js`
  - Remo√ß√£o de todas as verifica√ß√µes de permiss√£o
  - Coordenadas simples sem complexidades de zoom
- ‚úÖ **Organiza√ß√£o de Arquivos**
  - Estrutura limpa e organizada
  - Remo√ß√£o de duplicatas e arquivos tempor√°rios
  - Documenta√ß√£o atualizada e consistente

### **Fase 11: Sistema D&D 5e Completo**
- ‚úÖ **Fichas de Personagem D&D 5e**
  - Sistema completo de fichas com 6 p√°ginas
  - Atributos, per√≠cias, combate, magias, equipamentos
  - C√°lculos autom√°ticos de modificadores
  - Interface responsiva e intuitiva
- ‚úÖ **Sistema de Dados Integrado**
  - Rolagem direta das fichas para o chat
  - Suporte a vantagem/desvantagem
  - Detec√ß√£o autom√°tica de cr√≠ticos
  - Modificadores din√¢micos
- ‚úÖ **Sistema de Combate**
  - Ataques com armas (d20 ‚Üí damage)
  - Rolagem de dano com cr√≠ticos
  - Sistema de magias completo
  - Integra√ß√£o com chat em tempo real
- ‚úÖ **Sistema de Recursos**
  - Tracker de HP, AC, velocidade
  - Slots de magia por n√≠vel
  - Moedas D&D 5e (PC, PP, PE, PO, PL)
  - Invent√°rio de equipamentos
- ‚úÖ **Arquitetura Modular**
  - Sistema plug√°vel para m√∫ltiplos RPGs
  - Base extens√≠vel para outros sistemas
  - Separa√ß√£o clara de responsabilidades

### **Fase 12: Sistema de Transfer√™ncia de Personagens**
- ‚úÖ **Workflow de GM Otimizado**
  - Cria√ß√£o de cards vazios de personagem
  - Vincula√ß√£o posterior a jogadores
  - Interface de transfer√™ncia completa
- ‚úÖ **API de Transfer√™ncia**
  - Endpoint dedicado para transfer√™ncias
  - Valida√ß√µes de seguran√ßa e neg√≥cio
  - Suporte a personagens n√£o vinculados
- ‚úÖ **Modal de Transfer√™ncia**
  - Sele√ß√£o de jogadores dispon√≠veis
  - Valida√ß√£o de conflitos
  - Feedback visual e notifica√ß√µes
- ‚úÖ **Sistema de Permiss√µes**
  - Apenas GM pode transferir personagens
  - Valida√ß√£o de membros da campanha
  - Preven√ß√£o de duplicatas

## üèóÔ∏è Arquitetura T√©cnica

### **Stack Principal**
- **Frontend**: Next.js 15 (App Router)
- **Backend**: API Routes + Custom Server
- **Database**: SQLite + Prisma ORM
- **Auth**: NextAuth.js
- **Real-time**: Socket.IO
- **UI**: TailwindCSS + shadcn/ui
- **TypeScript**: Totalmente tipado

### **Estrutura do Banco de Dados**
```prisma
User
‚îú‚îÄ‚îÄ ownedCampaigns (Campaign[])
‚îú‚îÄ‚îÄ campaignMemberships (CampaignMember[])
‚îú‚îÄ‚îÄ characters (Character[])
‚îú‚îÄ‚îÄ chatMessages (ChatMessage[])
‚îî‚îÄ‚îÄ uploadedFiles (File[])

Campaign
‚îú‚îÄ‚îÄ owner (User)
‚îú‚îÄ‚îÄ members (CampaignMember[])
‚îú‚îÄ‚îÄ maps (Map[])
‚îú‚îÄ‚îÄ characters (Character[])
‚îú‚îÄ‚îÄ chatMessages (ChatMessage[])
‚îú‚îÄ‚îÄ handouts (Handout[])
‚îú‚îÄ‚îÄ gameState (GameState?)
‚îú‚îÄ‚îÄ sheetTemplates (SheetTemplate[])
‚îî‚îÄ‚îÄ files (File[])
```

### **APIs Implementadas (30+ Endpoints)**

#### **Autentica√ß√£o**
- `POST /api/auth/register` - Registro de usu√°rios
- `GET/POST /api/auth/[...nextauth]` - Login/logout com NextAuth

#### **Campanhas**
- `GET /api/campaigns` - Listagem de campanhas
- `POST /api/campaigns/create` - Cria√ß√£o de campanhas
- `GET /api/campaigns/[id]` - Detalhes da campanha
- `PUT /api/campaigns/[id]` - Atualiza√ß√£o de campanhas
- `DELETE /api/campaigns/[id]` - Exclus√£o de campanhas

#### **Personagens**
- `GET /api/campaigns/[id]/characters` - Listagem com filtros avan√ßados
- `POST /api/campaigns/[id]/characters` - Cria√ß√£o de personagens
- `GET /api/campaigns/[id]/characters/[characterId]` - Busca espec√≠fica
- `PUT /api/campaigns/[id]/characters/[characterId]` - Atualiza√ß√£o
- `DELETE /api/campaigns/[id]/characters/[characterId]` - Exclus√£o

#### **Templates de Fichas**
- `GET /api/campaigns/[id]/sheet-templates` - Templates dispon√≠veis
- `POST /api/campaigns/[id]/sheet-templates` - Cria√ß√£o/atualiza√ß√£o
- `GET /api/campaigns/[id]/templates` - Templates com valida√ß√£o
- `POST /api/campaigns/[id]/templates` - Cria√ß√£o de templates
- `GET/PUT/DELETE /api/campaigns/[id]/templates/[templateId]` - CRUD individual

#### **Chat e Mensagens**
- `GET /api/campaigns/[id]/messages` - Hist√≥rico de chat
- `POST /api/campaigns/[id]/messages` - Envio de mensagens

#### **Mapas**
- `GET /api/campaigns/[id]/maps` - Listagem de mapas
- `POST /api/campaigns/[id]/maps` - Cria√ß√£o de mapas
- `PUT /api/campaigns/[id]/maps/[mapId]` - Atualiza√ß√£o
- `DELETE /api/campaigns/[id]/maps/[mapId]` - Exclus√£o
- `POST /api/campaigns/[id]/maps/[mapId]/activate` - Ativa√ß√£o

#### **Handouts**
- `GET /api/campaigns/[id]/handouts` - Listagem com filtros
- `POST /api/campaigns/[id]/handouts` - Cria√ß√£o
- `PUT /api/campaigns/[id]/handouts/[handoutId]` - Atualiza√ß√£o
- `DELETE /api/campaigns/[id]/handouts/[handoutId]` - Exclus√£o
- `POST /api/campaigns/[id]/handouts/[handoutId]/share` - Compartilhamento

#### **Estado do Jogo**
- `GET /api/campaigns/[id]/game-state` - Estado atual
- `POST /api/campaigns/[id]/game-state` - Atualiza√ß√£o do estado

#### **Tokens (B√°sico)**
- `GET /api/campaigns/[id]/tokens` - Lista b√°sica de tokens
- `GET /api/campaigns/[id]/auto-tokens` - Endpoint de compatibilidade

#### **Transfer√™ncia de Personagens**
- `POST /api/campaigns/[id]/characters/[characterId]/transfer` - Transferir personagem

#### **Gerenciamento de Jogadores**
- `GET /api/campaigns/[id]/players` - Lista de membros
- `POST /api/campaigns/[id]/add-player` - Adicionar jogador
- `POST /api/campaigns/[id]/remove-player` - Remover jogador
- `GET /api/campaigns/[id]/search-players` - Busca de jogadores

#### **Sistema de Convites**
- `POST /api/campaigns/[id]/create-invite` - Criar convite
- `GET /api/invites/[token]` - Validar convite
- `POST /api/invites/[token]` - Aceitar convite

#### **Upload de Arquivos**
- `GET/POST /api/upload` - Sistema de upload
- `GET /api/campaigns/[id]/files` - Arquivos da campanha

### **Componentes WebSocket**
- **Server Bridge**: `lib/socket-bridge.js` - Servidor Socket.IO com eventos completos
  - Autentica√ß√£o de usu√°rios e valida√ß√£o de campanhas
  - Eventos: chat, token movement, map activation, player join/leave
  - Gerenciamento de rooms por campanha
  - Sistema b√°sico de tokens sem permiss√µes
- **Client Singleton**: `hooks/use-socket.ts` - Hook singleton para conex√£o compartilhada
  - Preven√ß√£o de m√∫ltiplas conex√µes
  - Gerenciamento de estado (mensagens, players, tokens)
  - Auto-reconnection e error handling
- **Hooks Especializados**:
  - `use-active-map.ts` - Escuta mudan√ßas de mapas ativos
  - `use-map-notifications.ts` - Notifica√ß√µes de ativa√ß√£o de mapas
  - `use-tokens.ts` - Gerenciamento b√°sico de tokens
- **Events Suportados**: 
  - `campaign:join/leave` - Entrada/sa√≠da de campanhas
  - `chat:send` / `chat:message` - Sistema de chat
  - `token_move` / `game:token-move` - Movimenta√ß√£o b√°sica de tokens
  - `game:map-activate` / `map:activated` - Ativa√ß√£o de mapas
  - `player:join/leave` - Players conectados

## üìÅ Estrutura de Arquivos (Organizada)

```
app/
‚îú‚îÄ‚îÄ layout.tsx                    # Root layout com ClientProviders
‚îú‚îÄ‚îÄ page.tsx                      # Redirect para /login
‚îú‚îÄ‚îÄ login/page.tsx               # P√°gina de login integrada
‚îú‚îÄ‚îÄ register/page.tsx            # P√°gina de registro integrada
‚îú‚îÄ‚îÄ dashboard/page.tsx           # Dashboard com campanhas reais
‚îú‚îÄ‚îÄ campaign/[id]/
‚îÇ   ‚îú‚îÄ‚îÄ play/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # Server Component principal
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ game-client.tsx      # Client Component da interface
‚îÇ   ‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # Configura√ß√µes da campanha
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings-client.tsx  # Client component das configura√ß√µes
‚îÇ   ‚îî‚îÄ‚îÄ sheet/[sheetId]/page.tsx # Visualiza√ß√£o de fichas
‚îú‚îÄ‚îÄ invite/[token]/
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # P√°gina de aceite de convites
‚îÇ   ‚îî‚îÄ‚îÄ invite-client.tsx        # Client component do convite
‚îî‚îÄ‚îÄ api/
    ‚îú‚îÄ‚îÄ auth/
    ‚îÇ   ‚îú‚îÄ‚îÄ register/route.ts    # API de registro
    ‚îÇ   ‚îî‚îÄ‚îÄ [...nextauth]/route.ts # NextAuth endpoints
    ‚îú‚îÄ‚îÄ campaigns/
    ‚îÇ   ‚îú‚îÄ‚îÄ create/route.ts      # API cria√ß√£o campanha
    ‚îÇ   ‚îî‚îÄ‚îÄ [id]/
    ‚îÇ       ‚îú‚îÄ‚îÄ route.ts         # CRUD campanha
    ‚îÇ       ‚îú‚îÄ‚îÄ messages/route.ts # API de mensagens
    ‚îÇ       ‚îú‚îÄ‚îÄ characters/      # CRUD personagens
    ‚îÇ       ‚îú‚îÄ‚îÄ handouts/        # CRUD handouts
    ‚îÇ       ‚îú‚îÄ‚îÄ maps/            # CRUD mapas
    ‚îÇ       ‚îú‚îÄ‚îÄ tokens/          # Sistema b√°sico de tokens
    ‚îÇ       ‚îú‚îÄ‚îÄ auto-tokens/route.ts # Endpoint de compatibilidade
    ‚îÇ       ‚îú‚îÄ‚îÄ game-state/route.ts  # Estado do jogo
    ‚îÇ       ‚îú‚îÄ‚îÄ players/route.ts     # Gerenciamento jogadores
    ‚îÇ       ‚îú‚îÄ‚îÄ templates/       # Templates de fichas
    ‚îÇ       ‚îî‚îÄ‚îÄ create-invite/route.ts # Sistema convites
    ‚îú‚îÄ‚îÄ invites/[token]/route.ts # Aceitar convites
    ‚îú‚îÄ‚îÄ upload/route.ts          # Upload de arquivos
    ‚îî‚îÄ‚îÄ user/update/route.ts     # Atualiza√ß√£o perfil

components/
‚îú‚îÄ‚îÄ providers/
‚îÇ   ‚îî‚îÄ‚îÄ client-providers.tsx    # Wrapper para React Context
‚îú‚îÄ‚îÄ game/
‚îÇ   ‚îú‚îÄ‚îÄ chat-panel.tsx          # Interface de chat
‚îÇ   ‚îú‚îÄ‚îÄ tactical-grid.tsx       # Grid t√°tico b√°sico
‚îÇ   ‚îú‚îÄ‚îÄ token.tsx               # Componente de token b√°sico
‚îÇ   ‚îú‚îÄ‚îÄ unified-sidebar.tsx     # Sidebar principal
‚îÇ   ‚îî‚îÄ‚îÄ players-panel.tsx       # Painel de jogadores
‚îú‚îÄ‚îÄ sidebar-content/
‚îÇ   ‚îú‚îÄ‚îÄ player-content-view.tsx        # Conte√∫do para jogadores
‚îÇ   ‚îú‚îÄ‚îÄ gm-content-view.tsx           # Conte√∫do para mestres
‚îÇ   ‚îú‚îÄ‚îÄ player-character-sheet-panel.tsx # Ficha do jogador
‚îÇ   ‚îú‚îÄ‚îÄ handout-list.tsx              # Lista de handouts
‚îÇ   ‚îú‚îÄ‚îÄ map-list.tsx                  # Lista de mapas
‚îÇ   ‚îú‚îÄ‚îÄ npc-list.tsx                  # Lista de NPCs
‚îÇ   ‚îî‚îÄ‚îÄ creature-list.tsx             # Lista de criaturas
‚îú‚îÄ‚îÄ modals/
‚îÇ   ‚îú‚îÄ‚îÄ create-character-modal.tsx    # Modal de cria√ß√£o integrado
‚îÇ   ‚îú‚îÄ‚îÄ view-handout-modal.tsx        # Visualiza√ß√£o de handouts
‚îÇ   ‚îî‚îÄ‚îÄ share-handout-modal.tsx       # Compartilhamento
‚îú‚îÄ‚îÄ settings/
‚îÇ   ‚îú‚îÄ‚îÄ general-settings.tsx          # Configura√ß√µes gerais
‚îÇ   ‚îú‚îÄ‚îÄ player-management.tsx         # Gerenciamento jogadores
‚îÇ   ‚îî‚îÄ‚îÄ sheet-template-editor.tsx     # Editor de templates
‚îú‚îÄ‚îÄ file-manager/
‚îÇ   ‚îú‚îÄ‚îÄ file-manager.tsx              # Gerenciador completo
‚îÇ   ‚îî‚îÄ‚îÄ file-upload.tsx               # Upload com drag&drop
‚îú‚îÄ‚îÄ ui/                               # Componentes shadcn/ui
‚îî‚îÄ‚îÄ [outros componentes espec√≠ficos]

lib/
‚îú‚îÄ‚îÄ auth.ts                     # Configura√ß√£o NextAuth
‚îú‚îÄ‚îÄ prisma.ts                   # Cliente Prisma
‚îú‚îÄ‚îÄ socket-bridge.js            # Servidor WebSocket b√°sico
‚îú‚îÄ‚îÄ dice.ts                     # Sistema de dados
‚îî‚îÄ‚îÄ utils.ts                    # Utilit√°rios gerais

hooks/
‚îú‚îÄ‚îÄ use-socket.ts              # Hook WebSocket integrado
‚îú‚îÄ‚îÄ use-characters.ts          # Gerenciamento de personagens
‚îú‚îÄ‚îÄ use-tokens.ts              # Gerenciamento b√°sico de tokens
‚îú‚îÄ‚îÄ use-active-map.ts          # Mapas ativos
‚îú‚îÄ‚îÄ use-map-notifications.ts   # Notifica√ß√µes de mapas
‚îî‚îÄ‚îÄ use-handouts.ts            # Gerenciamento de handouts

docs/
‚îú‚îÄ‚îÄ README.md                  # Documenta√ß√£o principal
‚îú‚îÄ‚îÄ 01-authentication.md      # Sistema de autentica√ß√£o
‚îú‚îÄ‚îÄ 02-campaign-management.md # Gerenciamento de campanhas
‚îú‚îÄ‚îÄ 03-character-system.md    # Sistema de personagens
‚îú‚îÄ‚îÄ 04-chat-realtime.md       # Chat em tempo real
‚îú‚îÄ‚îÄ 05-tactical-grid.md       # Grid t√°tico
‚îú‚îÄ‚îÄ 06-handouts-system.md     # Sistema de handouts
‚îú‚îÄ‚îÄ 07-file-management.md     # Gerenciamento de arquivos
‚îú‚îÄ‚îÄ 08-api-reference.md       # Refer√™ncia da API
‚îú‚îÄ‚îÄ 09-setup-deployment.md    # Setup e deploy
‚îú‚îÄ‚îÄ 10-development-roadmap.md # Roadmap desenvolvimento
‚îî‚îÄ‚îÄ SHEET_TEMPLATES.md        # Templates de fichas
```

## üéÆ Funcionalidades Implementadas

### **Autentica√ß√£o**
- ‚úÖ Login/Register com valida√ß√£o
- ‚úÖ Prote√ß√£o de rotas
- ‚úÖ Sess√µes persistentes
- ‚úÖ Redirecionamentos autom√°ticos

### **Gerenciamento de Campanhas**
- ‚úÖ Cria√ß√£o de campanhas com sistema customiz√°vel
- ‚úÖ Dashboard com listagem din√¢mica
- ‚úÖ Controle de acesso (GM/Jogador)
- ‚úÖ Valida√ß√£o de permiss√µes

### **Interface de Jogo**
- ‚úÖ P√°gina principal com layout limpo
- ‚úÖ Sidebar unificada com abas (Comunica√ß√£o/Conte√∫do)
- ‚úÖ Chat em tempo real
- ‚úÖ Sistema de comandos (/r, /ooc)
- ‚úÖ Grid t√°tico b√°sico funcional
- ‚úÖ Sistema de tokens simplificado

### **Sistema de Chat**
- ‚úÖ Mensagens em tempo real
- ‚úÖ Hist√≥rico persistente
- ‚úÖ Comandos de dados integrados
- ‚úÖ Mensagens OOC (Out of Character)
- ‚úÖ Indicadores de conex√£o

### **Sistema de Personagens**
- ‚úÖ CRUD completo de personagens (PC, NPC, CREATURE)
- ‚úÖ Templates din√¢micos de fichas
- ‚úÖ Campos customiz√°veis por template
- ‚úÖ Sistema de cria√ß√£o unificado
- ‚úÖ Visualiza√ß√£o de fichas com renderiza√ß√£o din√¢mica
- ‚úÖ Mini resumos na sidebar
- ‚úÖ Filtros por tipo e criador
- ‚úÖ Busca e estat√≠sticas

### **Grid T√°tico e Sistema de Tokens**
- ‚úÖ **Grid B√°sico Funcional** (800x600px fixo)
- ‚úÖ **Sistema de Tokens Ultra-Simples**:
  - ‚úÖ Movimenta√ß√£o livre para todos os usu√°rios
  - ‚úÖ Sincroniza√ß√£o em tempo real via WebSocket
  - ‚úÖ Coordenadas simples (pixel-based)
  - ‚úÖ Sem verifica√ß√µes de permiss√£o
  - ‚úÖ Sistema est√°vel e confi√°vel
- ‚úÖ **Mapas Din√¢micos**:
  - ‚úÖ Ativa√ß√£o em tempo real via WebSocket
  - ‚úÖ Notifica√ß√µes autom√°ticas de mudan√ßa
  - ‚úÖ Preview de mapas na sidebar

### **Sistema de Handouts**
- ‚úÖ CRUD completo de handouts
- ‚úÖ Sistema de compartilhamento GM ‚Üí Jogadores
- ‚úÖ Suporte a anexos e preview
- ‚úÖ Notifica√ß√µes de compartilhamento

### **Sistema de Arquivos**
- ‚úÖ Upload de arquivos com valida√ß√£o
- ‚úÖ Categoriza√ß√£o por tipo
- ‚úÖ Interface drag & drop
- ‚úÖ Gerenciamento completo

### **Configura√ß√µes da Campanha**
- ‚úÖ Interface completa para GM
- ‚úÖ Gerenciamento de jogadores
- ‚úÖ Sistema de convites
- ‚úÖ Editor de templates de fichas
- ‚úÖ Configura√ß√µes gerais

## üîß Corre√ß√µes T√©cnicas Importantes

### **Sistema de Tokens Simplificado**
- **Problema**: Sistema enhanced com loops infinitos e erros de compila√ß√£o
- **Solu√ß√£o**: Implementa√ß√£o ultra-b√°sica com movimento livre e WebSocket
- **Resultado**: Sistema est√°vel, funcional e confi√°vel

### **Limpeza de C√≥digo √ìrf√£o**
- **Problema**: Hooks n√£o utilizados e documenta√ß√£o desatualizada
- **Solu√ß√£o**: Remo√ß√£o completa de c√≥digo √≥rf√£o e reorganiza√ß√£o
- **Resultado**: Codebase limpo e organizado

### **WebSocket Integrado**
- **Problema**: M√∫ltiplas conex√µes e conflitos
- **Solu√ß√£o**: Uso do `socket-bridge.js` existente
- **Resultado**: Sincroniza√ß√£o perfeita de tokens e chat

### **Permiss√µes Removidas**
- **Problema**: Bloqueios impedindo movimento de tokens
- **Solu√ß√£o**: Remo√ß√£o de todas as verifica√ß√µes de permiss√£o
- **Resultado**: Movimento livre para todos os usu√°rios

## üöÄ Fases Futuras (Planejadas)

### **Fase 11: Funcionalidades Avan√ßadas**
- [ ] Sistema de iniciativa e combate
- [ ] Fog of War no grid t√°tico
- [ ] Sistema de macros e automa√ß√£o
- [ ] Integra√ß√£o com APIs de dados de RPG
- [ ] Sistema de audio/v√≠deo integrado

### **Fase 12: Otimiza√ß√µes e Performance**
- [ ] Otimiza√ß√£o de queries do banco
- [ ] Implementa√ß√£o de cache (Redis)
- [ ] Lazy loading de componentes
- [ ] Otimiza√ß√£o de assets e imagens
- [ ] Performance monitoring

### **Fase 13: Testes e Qualidade**
- [ ] Testes unit√°rios automatizados
- [ ] Testes de integra√ß√£o
- [ ] Testes end-to-end
- [ ] Testes de performance
- [ ] Documenta√ß√£o t√©cnica completa

## üèÉ‚Äç‚ôÇÔ∏è Como Executar

```bash
# Instalar depend√™ncias
npm install --legacy-peer-deps

# Configurar banco de dados
npx prisma migrate dev

# Executar em desenvolvimento
npm run dev
```

## üîê Vari√°veis de Ambiente

```env
DATABASE_URL="file:./dev.db"
NEXTAUTH_SECRET="your-secret-here"
NEXTAUTH_URL="http://localhost:3000"
```

## üìä Status Atual

**Progresso**: 12/15 fases conclu√≠das (80%)  
**Backend**: Sistema completo com 30+ APIs  
**Frontend**: Interface totalmente integrada e funcional  
**Real-time**: Chat + WebSocket + Notifica√ß√µes  
**Database**: Schema completo e est√°vel  
**Personagens**: Sistema completo CRUD + Templates + Visualiza√ß√£o  
**Handouts**: Sistema completo de documentos e compartilhamento  
**Mapas**: Sistema completo com grid t√°tico b√°sico  
**Tokens**: Sistema ultra-simples e est√°vel  
**Arquivos**: Upload e gerenciamento completo  
**Configura√ß√µes**: Interface completa de configura√ß√£o  
**Convites**: Sistema completo de convites  
**Limpeza**: C√≥digo organizado e sem √≥rf√£os  

## üéØ Estado Funcional Atual

O projeto est√° **totalmente funcional** para uso b√°sico de RPG:

### **‚úÖ O que est√° 100% funcional:**
- üîê **Autentica√ß√£o completa** (login, registro, prote√ß√£o de rotas)
- üè† **Dashboard din√¢mico** (cria√ß√£o e listagem de campanhas)
- üéÆ **Interface de jogo** (roles GM/Jogador, sidebar unificada)
- üí¨ **Chat em tempo real** (mensagens, comandos de dados, OOC)
- üë• **Sistema de personagens** (cria√ß√£o, visualiza√ß√£o, gerenciamento)
- üìã **Templates de fichas** (campos din√¢micos, valida√ß√£o)
- üé≠ **NPCs e Criaturas** (listagem, cria√ß√£o, mini resumos)
- üëë **Vis√£o do Mestre** (fichas dos jogadores, gerenciamento completo)
- üõ°Ô∏è **Vis√£o do Jogador** (sua ficha, cria√ß√£o de personagem)
- üìÑ **Sistema de Handouts** (documentos, compartilhamento, anexos)
- üó∫Ô∏è **Sistema de Mapas** (upload, ativa√ß√£o em tempo real)
- üéØ **Grid T√°tico B√°sico** (800x600px, est√°vel)
- üé™ **Tokens Ultra-Simples** (movimento livre, sincroniza√ß√£o WebSocket)
- üìÅ **Gerenciador de Arquivos** (upload, categoriza√ß√£o, preview)
- ‚öôÔ∏è **Configura√ß√µes da Campanha** (players, templates, settings)
- üîó **Sistema de Convites** (cria√ß√£o, expira√ß√£o, aceita√ß√£o)
- üîî **Notifica√ß√µes** (mapas, handouts, tempo real)
- üåê **WebSocket Robusto** (singleton, auto-reconnect)
- üßπ **C√≥digo Limpo** (organizado, sem √≥rf√£os, documentado)
- üìÉ **Fichas D&D 5e Completas** (6 p√°ginas, c√°lculos autom√°ticos)
- üé≤ **Sistema de Dados Integrado** (rolagem para chat, vantagem/desvantagem)
- ‚öîÔ∏è **Combate Completo** (ataques, dano, magias, cr√≠ticos)
- üîÑ **Transfer√™ncia de Personagens** (GM cria cards vazios ‚Üí vincula jogadores)

### **üîÑ Fluxo Completo Dispon√≠vel:**
1. **Registro/Login** ‚Üí **Dashboard** ‚Üí **Criar Campanha**
2. **Configurar Campanha** ‚Üí **Criar Templates** ‚Üí **Convidar Jogadores**
3. **Entrar na Campanha** ‚Üí **Definir Role** ‚Üí **Interface de Jogo**
4. **Chat em Tempo Real** + **Comandos de Dados** + **Players Conectados**
5. **Cria√ß√£o de Personagens** (PC/NPC/CREATURE) + **Templates Din√¢micos**
6. **Upload de Mapas** ‚Üí **Ativar Mapa em Tempo Real** ‚Üí **Grid T√°tico**
7. **Mover Tokens Livremente** (sem restri√ß√µes, sincroniza√ß√£o perfeita)
8. **Criar Handouts** ‚Üí **Compartilhar com Jogadores** ‚Üí **Notifica√ß√µes**
9. **Gerenciar Arquivos** ‚Üí **Upload de Assets** ‚Üí **Categoriza√ß√£o**
10. **Visualiza√ß√£o de Fichas** (din√¢mica por template) + **Avatares**
11. **Gerenciamento via Sidebar** (espec√≠fico por role) + **Estados em Tempo Real**
12. **Sistema de Convites** ‚Üí **Aceitar Convites** ‚Üí **Entrar na Campanha**

### **üöÄ Pr√≥ximo Foco:**
O projeto est√° **production-ready** como VTT b√°sico e funcional. As pr√≥ximas fases focar√£o em funcionalidades avan√ßadas como sistema de combate, fog of war, otimiza√ß√µes de performance e testes automatizados. O VTT est√° **est√°vel e confi√°vel** para uso em campanhas reais!

## üèÜ Conclus√£o

O **MesaRPG** representa um Virtual Tabletop **funcional e est√°vel** com:

- **30+ APIs** totalmente implementadas e testadas
- **Interface moderna** com layout limpo e organizado
- **Grid T√°tico B√°sico** funcional e confi√°vel
- **Sistema de Tokens Ultra-Simples** com sincroniza√ß√£o perfeita
- **WebSocket Robusto** com padr√£o singleton est√°vel
- **Sistema em tempo real** ultra-est√°vel com auto-reconnect
- **Arquitetura escal√°vel** e bem estruturada
- **C√≥digo limpo** organizado sem depend√™ncias √≥rf√£s
- **Documenta√ß√£o atualizada** e sempre consistente

### **üéØ N√≠vel de Qualidade:**
- **Grid T√°tico**: B√°sico mas totalmente funcional
- **Sistema de Tokens**: Ultra-simples e 100% confi√°vel
- **WebSocket**: Arquitetura singleton robusta sem conflitos
- **Performance**: Otimizado para estabilidade m√°xima
- **UX/UI**: Interface polida com feedback visual
- **Estabilidade**: Sistema rock-solid sem erros cr√≠ticos

Este √© um projeto **production-ready** que oferece uma experi√™ncia **s√≥lida e confi√°vel** para campanhas de RPG online, priorizando estabilidade e funcionalidade sobre complexidade desnecess√°ria.